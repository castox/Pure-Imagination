# THIS FILE EXISTS TO ENSURE CUSTOM GUI COMPATIBILITY!
# DO NOT EDIT THIS FILE DIRECTLY!
# IF YOU WISH TO INITIALIZE YOUR OWN GUI, DO IT BY:
# Creating an event widget
# Creating an event with that widget (See CustomGUI.1)
# Create a custom on_action file which appends to on_game_start_after_lobby and fires your event, as demonstrated below
# IF YOU WISH TO ADD A SIDEBAR BUTTON THAT OPENS THE CUSTOM GUI:
# Create a custom on_action which attaches to on_after_gui
# Fire the effect add_sidebar_button = {NAME = <string>}

##### GUI COMPATIBILITY ON_ACTIONS #####

# First we append to a vanilla on_action instead of editing the vanilla file, to ensure compatibility.
# Note that you can only append on_actions and events like this, NOT effects!
# Effects have to be invoked *in* the appended on_action!
# Empty scope
on_game_start_after_lobby = {
	on_actions = {
		on_custom_gui_initialize
	}
}
# This is the appended on_action which lets us initialize the GUI via event widget.
# This can have an effect block since it wouldn't overwrite anything.
on_custom_gui_initialize = {
	effect = {
		initialize_province_indices = yes
		fetch_very_small_province_indices = yes
		fetch_small_province_indices = yes
		fetch_medium_province_indices = yes
		fetch_province_indices = yes
		add_custom_gui = {NAME = custom_sidebar}
		add_custom_gui = {NAME = custom_sidebar_bg}
		every_player = {
			trigger_event = CustomGUI.2
		}
	}
	on_actions = {
		on_after_gui
		# on_monthly_custom_gui
		# delay = {days = 1}
		# on_daily_custom_gui
	}
}
# For save game compatibility; Once per year we check if the GUI has been initialized. Otherwise, initialize!
yearly_global_pulse = {
	on_actions = {
		ensure_GUI_exists
	}
}
# ROOT IS DUMMY_MALE
# THIS MUST HAVE FIRED FOR ADD_SIDEBAR_BUTTON AND ADD_CUSTOM_GUI TO WORK
# APPEND TO THIS (IN A DIFFERENT FILE) TO ENSURE CUSTOM GUIS ARE EXECUTED ON GAME START
# (However, add_sidebar_button can be executed whenever you want)
on_after_gui = {
	on_actions = {
	#	your_on_action_goes_here_but_in_a_different_file
	}
}
# If the basic GUI failed to be created for some reason, here's a do-over.
ensure_GUI_exists = {
	trigger = {
		NOT = {is_widget_open = custom_sidebar}
	}
	effect = {
		if = {
			limit = {
				exists = province:1.var:index
			}
			every_player = {
				trigger_event = CustomGUI.2
			}
		}
		else = {
			trigger_event = {
				on_action = on_custom_gui_initialize
			}
		}
	}
}